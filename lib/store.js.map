{"version":3,"sources":["../src/store.js"],"names":[],"mappings":";;AAAA,IAAI,CAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC1B,IAAI,KAAK,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;AAC/B,IAAI,UAAU,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;;AAEzC,SAAS,KAAK,CAAC,WAAW,EAAE,IAAI,EAAE;AAChC,MAAI,OAAO,GAAG,IAAI,KAAK,CAAC,GAAG,EAAE,CAAC;AAC9B,MAAI,GAAG,GAAG;AACR,eAAW,EAAE,WAAW;AACxB,UAAM,EAAE,CAAC,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC;AACjC,WAAO,EAAE,OAAO;GACjB,CAAC;;AAEF,MAAI,OAAO,GAAG,kBAAkB,CAAC,IAAI,CAAC,CAAC;AACvC,kBAAgB,CAAC,IAAI,EAAE,GAAG,EAAE,OAAO,CAAC,CAAC;AACrC,WAAS,CAAC,IAAI,EAAE,GAAG,EAAE,UAAU,CAAC,KAAK,CAAC,CAAC;AACvC,SAAO,GAAG,CAAC;CACZ;;AAED,SAAS,kBAAkB,CAAC,IAAI,EAAE;AAChC,SAAO,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,UAAU,GAAG,EAAE;AAC3C,WAAO,CAAC,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,EAAE,GAAG,CAAC,CAAC;GACpC,CAAC,CAAC;CACJ;;AAED,SAAS,gBAAgB,CAAC,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;AAC9C,GAAC,CAAC,IAAI,CAAC,OAAO,EAAE,UAAS,GAAG,EAAE;AAC5B,SAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC,CAAC;GACvC,CAAC,CAAC;CACJ;;AAED,SAAS,SAAS,CAAC,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE;AACrC,WAAS,MAAM,CAAC,MAAM,EAAE,QAAQ,EAAE;AAChC,UAAM,CAAC,OAAO,CAAC,UAAU,KAAK,EAAE;AAC9B,UAAI,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,KAAK,EAAE;AACnC,aAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC;AAC/B,kBAAU,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;OACpC;KACF,CAAC,CAAC;GACJ;AACD,OAAK,CAAC,IAAI,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;CAC3B;;AAED,MAAM,CAAC,OAAO,GAAG;AACf,OAAK,EAAE,KAAK;CACb,CAAC","file":"store.js","sourcesContent":["var _ = require('lodash');\nvar Bacon = require('baconjs');\nvar dispatcher = require('./dispatcher');\n\nfunction store(displayName, spec) {\n  var changes = new Bacon.Bus();  \n  var obj = {\n    displayName: displayName,\n    output: _.extend({}, spec.output),\n    changes: changes\n  };\n  \n  var methods = gatherStoreMethods(spec);\n  bindStoreMethods(spec, obj, methods);\n  wireStore(spec, obj, dispatcher.input);\n  return obj;\n}\n\nfunction gatherStoreMethods(spec) {\n  return _.reject(_.keys(spec), function (key) {\n    return _.contains(['output'], key);\n  });\n}\n\nfunction bindStoreMethods(spec, store, methods) {\n  _.each(methods, function(key) {\n    store[key] = _.bind(spec[key], store);\n  });\n}\n\nfunction wireStore(spec, store, input) {\n  function output(stream, property) {\n    stream.onValue(function (value) {\n      if (store.output[property] != value) {\n        store.output[property] = value;\n        dispatcher.markStoreAsDirty(store);        \n      }\n    });\n  }\n  store.wire(input, output);\n} \n  \nmodule.exports = {\n  store: store\n};\n"]}